<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>CoronaVirus</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"/>
    <script type="javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script type="javascript" src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script type="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

</h:head>
<body>

<div class="container-fluid">
    <div class="row">
        <div class="col text-md-center">
            <div class="card w-100">
                <div class="card-body align-self-center text-sm-center">
                    <div id="regions_div" class="mb-3"></div>


                </div>
                <div id="statistic" class="row text-white align-middle justify-content-center font-weight-bold">
                    <div class="col-sm-2 rounded bg-warning m-2 pl-0 pr-0">
                        <span class="align-middle">Total Confirmed Cases</span>
                        <hr class="m-0"/>
                        <h:outputLabel styleClass="align-middle"
                                       value="#{covidController.coronaVirus.stats.totalConfirmedCases}"/>
                    </div>
                    <div class="col-sm-2 rounded bg-success m-2 pl-0 pr-0">
                        <span>Total Recovered Cases</span>
                        <hr class="m-0"/>
                        <h:outputLabel
                                value="#{covidController.coronaVirus.stats.totalRecoveredCases}"/>
                    </div>
                    <div class="col-sm-2 rounded bg-danger m-2 pl-0 pr-0">
                        <span>Total Deaths</span>
                        <hr class="m-0"/>
                        <h:outputLabel value="#{covidController.coronaVirus.stats.totalDeaths}"/>
                    </div>
                </div>


                <small>
                    <span class="text-muted">Last Updated: </span>
                    <h:outputLabel styleClass="text-muted"
                                   value="#{covidController.coronaVirus.updatedDateTime}"/>
                </small>

            </div>
            <div class="row">
                <div class="col-md-4">

                    <p:lineChart model="#{covidController.totalCasesLineChart}" styleClass="m-2"/>
                    <p:lineChart model="#{covidController.cartesianLinerModel}" styleClass="m-2"/>
                    <p:barChart model="#{covidController.dailyNewCasesChart}" styleClass="m-2"/>
                    <p:lineChart model="#{covidController.mortalityRateChart}" styleClass="m-2"/>
                </div>
                <div class="col-md-4">
                    <p:lineChart model="#{covidController.recoveredCasesLineChart}"
                                 styleClass="m-2"/>
                    <p:barChart model="#{covidController.monthlyCases}" styleClass="m-2"/>
                    <p:barChart model="#{covidController.dailyRecoveredChart}" styleClass="m-2"/>
                    <p:lineChart model="#{covidController.recoveredRateChart}" styleClass="m-2"/>
                </div>
                <div class="col-md-4">
                    <p:lineChart model="#{covidController.deathsCasesLineChart}" styleClass="m-2"/>
                    <p:lineChart model="#{covidController.recoveredDeathsLinerModel}"
                                 styleClass="m-2"/>
                    <p:barChart model="#{covidController.dailyDeathsChart}" styleClass="m-2"/>
                    <p:lineChart model="#{covidController.recoveryDeathRateLinerModel}"
                                 styleClass="m-2"/>
                </div>

            </div>
            <div class="row">
                <div id="container" class="container">
                    <div class="table-responsive">
                        <table class="table table-striped text-center" id="countryList">
                            <tr class="p-3 mb-2 bg-primary text-white text-center">
                                <th>#</th>
                                <th>Country Name</th>
                                <th>New Cases</th>
                                <th>New Deaths</th>
                                <th>New Recovered</th>
                                <th>Total Cases</th>
                                <th>Total Deaths</th>
                                <th>Total Recovered</th>
                            </tr>
                            <c:forEach var="breakdown" items="${breakdowns}" varStatus="status">
                                <tr>
                                    <td><h:outputText value="${status.count}"/></td>
                                    <td>
                                        <a href="${pageContext.request.contextPath}/covid/?countryCode=${breakdown.location.isoCode}">
                                            <h:outputText
                                                    value="${breakdown.location.countryOrRegion}  ${breakdown.location.provinceOrState}"/>
                                        </a>
                                    </td>
                                    <td> ${breakdown.newlyConfirmedCases} </td>
                                    <td> ${breakdown.newDeaths} </td>
                                    <td> ${breakdown.newlyRecoveredCases} </td>
                                    <td> ${breakdown.totalConfirmedCases} </td>
                                    <td> ${breakdown.totalDeaths} </td>
                                    <td> ${breakdown.totalRecoveredCases} </td>

                                </tr>
                            </c:forEach>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<h:inputHidden type="hidden" id="countryCode" value="#{covidController.coronaVirus.location.isoCode}"/>
<h:inputHidden type="hidden" id="mapsApiKey" value="#{covidController.mapsApiKey}"/>
<h:inputHidden type="hidden" id="totalConfirmedCases"
               value="#{covidController.coronaVirus.stats.totalConfirmedCases}"/>
<script type="text/javascript">

    var mapsApiKey = document.getElementById("mapsApiKey").value;
    var countryCode = document.getElementById("countryCode").value;

    google.charts.load('current', {
        'packages': ['geochart'],
        'mapsApiKey': mapsApiKey
    });
    google.charts.setOnLoadCallback(drawRegionsMap);

    function drawRegionsMap() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Country');
        data.addColumn('number', 'Total Cases');
        var table = document.getElementById("countryList");
        var r = 1; //start counting rows in table
        while (row = table.rows[r++]) {
            data.addRow([row.cells[1].innerText, parseInt(row.cells[5].innerText)]);
        }


        var options = {
            region: countryCode === '' ? null : countryCode,
            colorAxis: {colors: ['red']}
        };
        var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
        chart.draw(data, options);
    }
</script>

</body>

</html>
